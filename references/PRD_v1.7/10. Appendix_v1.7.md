### 10.1 Glossary

|Term|Definition|
|---|---|
|**MVP**|Minimum Viable Product - 최소 기능 제품|
|**PRD**|Product Requirements Document - 제품 요구사항 문서|
|**BaaS**|Backend as a Service - Firebase 등|
|**FCM**|Firebase Cloud Messaging - 푸시 알림 서비스|
|**Geohash**|위치 정보를 문자열로 인코딩하는 방식 (위치 기반 쿼리에 사용)|
|**Rate Limiting**|일정 시간 내 요청 수 제한 (하루 20건 등)|
|**Firestore**|Google의 NoSQL 클라우드 데이터베이스|
|**Security Rules**|Firestore/Storage 접근 권한 규칙|
|**Cloud Function**|서버리스 백엔드 로직 (알림 발송, 신고 처리 등)|
|**일감**|농업 작업을 의미하는 단감의 핵심 용어 (기존 "작업")|
|**일감 작성자**|일감을 등록한 사용자 (기존 "농부")|
|**일감 참여자**|일감에 지원/참여하는 사용자 (기존 "작업자")|
|**계약서**|일감 작성자와 참여자 간 합의 조건을 문서화한 것|
|**양방향 사용자**|일감을 등록하면서 동시에 다른 일감에 참여하는 사용자|
|**Dan-Gam Orange**|단감의 Primary 브랜드 컬러 (#EC6737)|
|**Put-Gam Green**|단감의 Secondary 브랜드 컬러 (#95A543)|

### 10.2 References

|Document|Link|Purpose|
|---|---|---|
|Firebase Documentation|https://firebase.google.com/docs|Firebase 구현 참고|
|Google Maps Platform|https://developers.google.com/maps|지도 API 사용법|
|Flutter Documentation|https://flutter.dev/docs|Flutter 개발 가이드|
|GeoFlutterFire|https://github.com/DarshanGowda0/GeoFlutterFire|위치 기반 쿼리 라이브러리|
|Riverpod Documentation|https://riverpod.dev|상태관리 가이드|
|개인정보보호법|https://www.law.go.kr|법적 준수 사항 확인|
|WCAG 2.1|https://www.w3.org/WAI/WCAG21/quickref/|접근성 가이드라인|
|Kakao Developers|https://developers.kakao.com|카카오 로그인 API|
|Apple Sign In|https://developer.apple.com/sign-in-with-apple/|Apple 로그인 가이드|

### 10.3 Change Log

|Version|Date|Changes|Author|
|---|---|---|---|
|v1.0|2025-10-13|초안 작성|김현영|
|v1.1|2025-10-13|세부 기능 및 화면 구조 구체화|김현영|
|v1.2|2025-10-13|전화번호 교환 시스템 개선 (상호 동의 기반)|김현영|
|v1.3|2025-10-13|PRD 형식 전환, 요구사항 명세화, 구조 표준화|김현영|
|v1.4|2025-10-15|상태관리 확정, 개발 일정 변경|김현영|
|v1.5|2025-10-15|전화번호 교환 → 인앱 메시징 전환, 카카오/Apple 로그인 추가|김현영|
|v1.6|2025-10-16|9주 일정 조정, 메시징 시스템 공수 현실화 (Week 3-4 2주 확보)|김현영|
|v1.7|2025-10-20|**역할 통합, 용어 변경, 일감 상태값 확장, 계약서 시스템 추가, 컬러 변경**|김현영|

### 10.4 Detailed Changes (v1.6 → v1.7)

#### 1. 역할 구조 통합 (당근마켓 방식)

**변경 사항:**

- UserProfiles.role 필드 **제거**
- 회원가입 시 역할 선택 단계 **제거**
- FR-002 (역할 선택) **삭제**
- 메인 화면 구조 통합: "일감 찾기" / "내 일감" 탭

**영향받는 문서:**

- 1. Product Brief: 페르소나 통합, 가치 제안 재정의
- 2. Functional Requirements: FR-001, FR-002 수정/삭제
- 4. UI Specifications: IA 구조 변경, UI-001, UI-002 수정
- 5. Data Model: UserProfiles 구조 변경
- 6. QA: TS-001, TS-009 추가/수정
- 7. Release Plan: Week 1 Task 수정

**비즈니스 로직:**

- 누구나 일감 등록 가능 (creatorId)
- 누구나 일감 참여 가능 (participantId)
- 자신이 등록한 일감에는 메시지 불가 (클라이언트 + Security Rules)
- "일감 찾기"에서 자신의 일감 자동 제외

#### 2. 용어 통일

|기존 용어|신규 용어|적용 범위|
|---|---|---|
|작업|일감|전체 문서 (UI, 코드 주석 제외)|
|작업 등록|일감 등록|전체 문서|
|작업자|일감 참여자|컨텍스트별|
|농부|일감 작성자|컨텍스트별|
|farmerId|creatorId|데이터 모델|
|workerId|participantId|데이터 모델|

**영향받는 문서:**

- 전체 문서 (1~10)
- 특히 FR, UI, Data Model에서 집중 변경

#### 3. 일감 상태값 확장

**기존 (v1.6):**

```
status: 'active' | 'deleted'
```

**신규 (v1.7 MVP):**

```
status: 'active' | 'contracted' | 'deleted'
```

**Phase 2 이후 확장 예정:**

```
status: 'active' | 'contracted' | 'in_progress' | 'completed' | 'reviewed' | 'cancelled' | 'deleted'
```

**상태 전환:**

- `active` → `contracted`: 계약서 양측 서명 완료
- `contracted` → `in_progress`: 작업 시작일 도래 (Phase 2)
- `in_progress` → `completed`: 작업 완료 (Phase 2)
- `completed` → `reviewed`: 후기 작성 (Phase 2)
- 모든 상태 → `cancelled`: 작성자 취소 (Phase 2)
- 모든 상태 → `deleted`: 신고 처리 또는 관리자 삭제

**영향받는 문서:**

- 5. Data Model: Jobs.status enum 확장
- 6. QA: 상태 전환 테스트 추가

#### 4. 계약서 시스템 추가

**신규 기능:**

- Contracts Collection 추가
- FR-030: 계약서 생성 및 작성
- FR-031: 계약서 서명
- FR-032: 계약 상태 관리
- UI-009: 계약서 작성 화면
- UI-010: 계약서 상세/서명 화면
- API-004: createContract
- API-005: signContract
- API-006: updateJobStatusOnContract (Cloud Function)

**비즈니스 로직:**

- 일감 작성자만 계약서 생성 가능
- 대화방당 1개 활성 계약서만 가능
- 양측 서명 필수
- 양측 서명 완료 시 일감 상태 `contracted`로 자동 변경
- 계약서는 메시지로 전송됨 (messageType='contract')

**영향받는 문서:**

- 2. Functional Requirements: FR-030~032 추가
- 4. UI Specifications: UI-009, UI-010 추가, UI-008 수정
- 5. Data Model: Contracts Collection 추가, Messages.messageType 추가
- 6. QA: TS-005 추가
- 7. Release Plan: Week 5 Task 추가
- 8. KPIs: 계약 관련 지표 추가
- 9. Risk Management: R-012, R-014 추가

#### 5. 컬러 시스템 변경

**기존 (v1.6):**

- Primary: #95A543 (Put-Gam Green)
- Secondary: #EC6737 (Dan-Gam Orange)

**신규 (v1.7):**

- **Primary: #EC6737 (Dan-Gam Orange)** ⭐
- **Secondary: #95A543 (Put-Gam Green)**
- Background: #FFF8E9 (Orchard Cream) - 유지

**적용 요소:**

- CTA 버튼: Dan-Gam Orange
- 활성 탭/선택 항목: Dan-Gam Orange
- 내 메시지 말풍선: Dan-Gam Orange 배경
- 읽지 않은 뱃지: Dan-Gam Orange
- 진행 바, 강조 텍스트: Dan-Gam Orange
- 서브 요소 (성공 상태 등): Put-Gam Green

**영향받는 문서:**

- 1. Product Brief: 컬러 정의 변경
- 4. UI Specifications: 전체 화면 컬러 업데이트, Design System 수정
- 6. QA: TS-011 추가 (컬러 시스템 테스트)
- 7. Release Plan: P1-T003, P4-T006 수정

#### 6. 기타 변경사항

**전화번호 완전 제거 재확인:**

- v1.5에서 이미 제거되었으나 v1.7에서 재확인
- UserProfiles에서 phoneNumber 관련 모든 필드 없음
- 카카오 로그인 + 메시징 + 계약서로 완전한 커뮤니케이션 체계 구축

**메인 화면 IA 재설계:**

```
[메인 화면]
 ├─ 상단 탭: [일감 찾기] [내 일감]
 │   ├─ 일감 찾기: [지도 뷰] [리스트 뷰]
 │   └─ 내 일감: 내가 등록한 일감 목록
 └─ 하단 네비게이션: [홈] [대화] [알림] [프로필]
```

**개발 일정 영향:**

- 총 개발 기간: 9주 유지
- Week 5에 계약서 시스템 개발 집중 (68시간)
- 역할 선택 제거로 Week 1 단순화 (56시간)

### 10.5 Migration Guide (v1.6 → v1.7)

#### 데이터베이스 마이그레이션

**UserProfiles Collection:**

```javascript
// 기존 문서에 role 필드가 있다면 제거
db.collection('userProfiles').get().then(snapshot => {
  snapshot.forEach(doc => {
    if (doc.data().role) {
      doc.ref.update({
        role: firebase.firestore.FieldValue.delete()
      });
    }
  });
});
```

**Jobs Collection:**

```javascript
// farmerId → creatorId 필드명 변경
db.collection('jobs').get().then(snapshot => {
  snapshot.forEach(doc => {
    if (doc.data().farmerId) {
      doc.ref.update({
        creatorId: doc.data().farmerId,
        creatorName: doc.data().farmerName,
        farmerId: firebase.firestore.FieldValue.delete(),
        farmerName: firebase.firestore.FieldValue.delete()
      });
    }
  });
});
```

**Contracts Collection 생성:**

```javascript
// 새로운 컬렉션이므로 마이그레이션 불필요
// 인덱스만 사전 생성
```

**Messages Collection:**

```javascript
// messageType 필드 추가 (기존 메시지는 'text'로 설정)
db.collection('messages').get().then(snapshot => {
  snapshot.forEach(doc => {
    if (!doc.data().messageType) {
      doc.ref.update({
        messageType: 'text'
      });
    }
  });
});
```

#### 클라이언트 코드 변경

**역할 관련 코드 제거:**

```dart
// 제거할 코드
// if (userProfile.role == 'farmer') { ... }
// if (userProfile.role == 'worker') { ... }

// 대체 코드
// 일감별로 관계 판단
if (job.creatorId == currentUserId) {
  // 일감 작성자 로직
} else {
  // 일감 참여자 로직
}
```

**용어 변경:**

```dart
// 모든 'job' 관련 UI 텍스트를 '일감'으로 변경
// 'farmerId' → 'creatorId'
// 'workerId' → 'participantId'
```

**컬러 코드 변경:**

```dart
// 기존
static const primaryColor = Color(0xFF95A543); // Green
static const secondaryColor = Color(0xFFEC6737); // Orange

// 신규
static const primaryColor = Color(0xFFEC6737); // Dan-Gam Orange ⭐
static const secondaryColor = Color(0xFF95A543); // Put-Gam Green
```

### 10.6 Approval

|Role|Name|Signature|Date|
|---|---|---|---|
|**Product Manager**|박기선||Pending|
|**Director**|최현민||Pending|
|**Development Lead**|김현영||2025-10-20|

---