### 2.1 Authentication & User Management

#### FR-001A: 카카오 로그인 회원가입

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical, Week 1)|
|**User Story**|신규 사용자로서, 카카오 계정으로 로그인하여 별도 회원가입 절차 없이 빠르게 서비스 이용하고 싶다|
|**Input**|카카오 Access Token|
|**Processing**|1. Kakao SDK로 로그인 → Access Token 받기<br>2. Cloud Function 호출 → Firebase Custom Token 생성<br>3. Firebase Auth signInWithCustomToken(customToken)|
|**Output**|인증 성공 시 UserProfile 자동 생성, 메인 화면으로 이동|
|**Business Rules**|- 카카오 앱 설치 시: 카카오톡 계정으로 로그인<br>- 카카오 앱 미설치 시: 웹 로그인 (Safari/Chrome)<br>- 중복 가입 방지: kakaoId로 uniqueness 체크<br>- 닉네임 자동 생성: 랜덤 키워드 조합 (중복 시 재생성)<br>- **역할 선택 불필요** (v1.7 변경)|
|**Error Handling**|- 카카오 서버 오류: "카카오 로그인에 실패했습니다. 다시 시도해주세요."<br>- 네트워크 오류: "인터넷 연결을 확인해주세요."<br>- Firebase Auth 오류: "로그인 처리 중 오류가 발생했습니다."|
|**Dependencies**|`kakao_flutter_sdk`, Cloud Function: `createKakaoCustomToken`|
|**Acceptance Criteria**|✓ "카카오로 시작하기" 버튼 표시<br>✓ 카카오 SDK 로그인 팝업 호출<br>✓ 카카오 Access Token 획득<br>✓ Cloud Function `createKakaoCustomToken` 호출<br>✓ Firebase Custom Token 받아서 `signInWithCustomToken()`<br>✓ UserProfile 자동 생성 (존재하지 않을 경우)<br>✓ **메인 화면으로 즉시 이동 (역할 선택 제거)**<br>✓ 실패 시 에러 메시지 표시 및 재시도 가능|

#### FR-001B: Apple 로그인 회원가입

|Attribute|Details|
|---|---|
|**Priority**|P1 (중요, Week 6 - TestFlight 전)|
|**User Story**|iOS 사용자로서, Apple 계정으로 로그인하여 개인정보 보호를 강화하고 Apple 정책을 준수하고 싶다|
|**Input**|Apple ID Token|
|**Processing**|1. Apple Sign In → ID Token 받기<br>2. Firebase Auth `signInWithCredential(OAuthProvider.credential())`|
|**Output**|인증 성공 시 UserProfile 자동 생성, 이메일 숨김 선택 시 프록시 이메일 저장, 메인 화면으로 이동|
|**Business Rules**|- iOS/macOS만 표시<br>- App Store 출시 전 필수 구현<br>- TestFlight 단계에서는 선택 사항<br>- **역할 선택 불필요** (v1.7 변경)|
|**Error Handling**|- Apple 서버 오류: "Apple 로그인에 실패했습니다. 다시 시도해주세요."<br>- 네트워크 오류: "인터넷 연결을 확인해주세요."|
|**Dependencies**|`sign_in_with_apple`, Firebase Auth Apple Provider|
|**Acceptance Criteria**|✓ "Apple로 시작하기" 버튼 표시 (iOS만)<br>✓ Apple Sign In 팝업 호출<br>✓ ID Token 획득<br>✓ Firebase Auth `signInWithCredential(OAuthProvider.credential())`<br>✓ UserProfile 자동 생성<br>✓ 이메일 숨김 선택 시 프록시 이메일 저장<br>✓ **메인 화면으로 즉시 이동 (역할 선택 제거)**|

#### FR-002: ~~역할 선택~~ (제거됨 - v1.7)

**변경 사유**: 단감은 당근마켓처럼 누구나 일감을 등록하거나 참여할 수 있는 양방향 플랫폼입니다. 따라서 회원가입 시 역할 선택이 불필요합니다.

**영향**:

- UserProfiles.role 필드 제거
- 회원가입 플로우 단순화: 로그인 → 메인 화면
- 메인 화면에서 "일감 찾기" / "내 일감" 탭으로 기능 구분

#### FR-003: 약관 동의

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical)|
|**User Story**|사용자로서, 최소한의 약관만 동의하고 빠르게 가입하고 싶다|
|**Input**|필수 약관 동의 체크박스 (1개)|
|**Processing**|동의 여부 확인 후 회원가입 진행|
|**Output**|동의 완료 시 메인 화면으로 이동 (역할 선택 제거됨)|
|**Business Rules**|- 필수 약관: "서비스 이용약관 동의" 1개만<br>- 선택 약관 없음<br>- 체크 필수 (미동의 시 진행 불가)|
|**Error Handling**|- 처리 실패 시 로그 기록 및 관리자 알림<br>- 오탐지 시 수동 복구 가능|
|**Dependencies**|FR-026 (신고 기능), Cloud Functions|
|**Acceptance Criteria**|✓ 정확히 3건 시 자동 조치<br>✓ 조치된 대상은 즉시 서비스에서 제외<br>✓ 관리자에게 조치 내역 이메일 발송|

### 2.8 Analytics & Logging

#### FR-028: 이벤트 로깅

|Attribute|Details|
|---|---|
|**Priority**|P2 (Medium)|
|**User Story**|시스템으로서, 사용자 행동을 추적하여 서비스 개선에 활용하고 싶다|
|**Input**|주요 사용자 액션 발생 시 트리거|
|**Processing**|Events Collection에 이벤트 문서 생성|
|**Output**|이벤트 로그 저장|
|**Business Rules**|- 로깅 대상 이벤트:<br> • job_created: 일감 등록<br> • job_view: 일감 상세 보기<br> • message_sent: 메시지 전송<br> • contract_created: 계약서 생성<br> • contract_signed: 계약서 서명<br>- 각 이벤트에 userId, jobId, conversationId, timestamp, metadata 포함<br>- 개인정보 제외 (전화번호 등)|
|**Error Handling**|- 로깅 실패 시 무시 (사용자 경험에 영향 없음)<br>- 비동기 처리|
|**Dependencies**|모든 주요 기능|
|**Acceptance Criteria**|✓ 모든 주요 액션이 누락 없이 로깅<br>✓ 로깅이 앱 성능에 영향 없음<br>✓ 개인정보가 로그에 포함되지 않음|

---|- 미동의 시: "서비스 이용을 위해 약관 동의가 필요합니다"| |**Dependencies**|None| |**Acceptance Criteria**|✓ 약관 전문 보기 링크 제공<br>✓ 체크박스 미선택 시 다음 버튼 비활성화|

#### FR-004: 사용자 프로필 관리

|Attribute|Details|
|---|---|
|**Priority**|P1 (High)|
|**User Story**|사용자로서, 내 기본 정보와 활동 지역을 설정하고 싶다|
|**Input**|닉네임 (선택), 주요 활동 지역 (선택)|
|**Processing**|UserProfile 문서 업데이트|
|**Output**|프로필 정보 저장 완료 메시지|
|**Business Rules**|- 닉네임 미입력 시 자동 생성 유지<br>- 지역은 시/군 단위<br>- **역할 필드 제거됨** (v1.7 변경)|
|**Error Handling**|- 네트워크 오류 시 재시도 옵션 제공|
|**Dependencies**|FR-001 (로그인 완료)|
|**Acceptance Criteria**|✓ 모든 필드가 선택 사항으로 표시<br>✓ 저장 시 즉시 반영|

#### FR-005: 로그아웃

|Attribute|Details|
|---|---|
|**Priority**|P2 (Medium)|
|**User Story**|사용자로서, 필요 시 로그아웃하여 계정을 보호하고 싶다|
|**Input**|로그아웃 버튼 클릭|
|**Processing**|Firebase Authentication 로그아웃, 로컬 캐시 삭제|
|**Output**|로그인 화면으로 이동|
|**Business Rules**|- 로그아웃 시 재로그인 필요<br>- 로컬 데이터는 유지 (오프라인 접근용)|
|**Error Handling**|- 네트워크 오류 시에도 로컬 세션 종료|
|**Dependencies**|None|
|**Acceptance Criteria**|✓ 로그아웃 확인 다이얼로그 표시<br>✓ 로그아웃 후 로그인 화면으로 이동|

#### FR-006: 회원 탈퇴

|Attribute|Details|
|---|---|
|**Priority**|P2 (Medium)|
|**User Story**|사용자로서, 서비스가 필요 없을 때 내 정보를 완전히 삭제하고 싶다|
|**Input**|회원 탈퇴 버튼 클릭, 최종 확인|
|**Processing**|UserProfile, 관련 데이터 삭제, Firebase Auth 계정 삭제|
|**Output**|탈퇴 완료 메시지, 로그인 화면으로 이동|
|**Business Rules**|- 등록한 일감이 있으면 "일감 마감 후 탈퇴 가능" 안내<br>- 탈퇴 시 모든 데이터 즉시 삭제<br>- 복구 불가 경고|
|**Error Handling**|- 진행 중인 일감이 있으면 탈퇴 차단<br>- 네트워크 오류 시 재시도 옵션|
|**Dependencies**|None|
|**Acceptance Criteria**|✓ 2단계 확인 (탈퇴 의사 재확인)<br>✓ 탈퇴 후 동일 번호로 재가입 가능<br>✓ 모든 개인정보 완전 삭제 확인|

### 2.2 Job Management (일감 관리)

#### FR-007: 일감 등록

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical)|
|**User Story**|사용자로서, 3분 내에 간단하게 인력이 필요한 일감을 등록하고 싶다|
|**Input**|작물 선택, 일감 내용, 일감 기간, 급여 정보, 위치, 사진(선택), 상세설명(선택)|
|**Processing**|Jobs Collection에 새 문서 생성, creatorId 및 메타데이터 저장|
|**Output**|일감 등록 완료, 메인 화면의 "내 일감" 탭 목록에 표시|
|**Business Rules**|- 작물: 12개 주요 작물 중 선택 (드롭다운)<br>- 일감 내용: 100자 제한<br>- 급여: 일당/시급 선택 후 금액 입력<br>- 위치: 지도에서 핀으로 지정<br>- 사진: 최대 3장<br>- 상세 설명: 500자 제한<br>- 초기 상태: `active` (모집중)|
|**Error Handling**|- 필수 필드 미입력 시 등록 불가<br>- 위치 권한 거부 시 안내 메시지<br>- 이미지 업로드 실패 시 재시도 옵션|
|**Dependencies**|FR-001 (로그인 완료), Google Maps API|
|**Acceptance Criteria**|✓ 3단계 스텝 진행 (작물 선택 → 정보 입력 → 위치 → 미리보기)<br>✓ 각 단계 30초 이내 완료 가능<br>✓ 등록 즉시 다른 사용자에게 노출|

#### FR-008: 일감 목록 조회 (내 일감)

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical)|
|**User Story**|사용자로서, 내가 등록한 일감들을 한눈에 보고 관리하고 싶다|
|**Input**|메인 화면 "내 일감" 탭 접근|
|**Processing**|Firestore에서 creatorId로 필터링하여 일감 목록 조회|
|**Output**|일감 카드 리스트 (작물명, 기간, 대화 수, 신규 메시지 뱃지)|
|**Business Rules**|- 최신 등록순 정렬<br>- 신규 메시지가 있으면 빨간 뱃지 표시<br>- 일감당 대화 수 표시<br>- 스와이프로 수정/삭제 가능|
|**Error Handling**|- 일감이 없으면 빈 상태 화면 표시<br>- 네트워크 오류 시 캐시된 데이터 표시|
|**Dependencies**|FR-007 (일감 등록)|
|**Acceptance Criteria**|✓ 일감 카드에 핵심 정보만 표시<br>✓ 신규 메시지 뱃지가 실시간 업데이트<br>✓ 스와이프 액션이 직관적|

#### FR-009: 일감 수정

|Attribute|Details|
|---|---|
|**Priority**|P1 (High)|
|**User Story**|사용자로서, 등록한 일감 정보가 변경되면 수정하고 싶다|
|**Input**|일감 선택, 수정할 필드 변경|
|**Processing**|Jobs 문서 업데이트|
|**Output**|수정 완료 메시지, 일감 목록에 반영|
|**Business Rules**|- 모든 필드 수정 가능<br>- 이미 보낸 메시지에는 영향 없음<br>- 수정 시간 기록 (updatedAt)|
|**Error Handling**|- 네트워크 오류 시 재시도 옵션<br>- 동시 수정 충돌 방지 (낙관적 잠금)|
|**Dependencies**|FR-007 (일감 등록)|
|**Acceptance Criteria**|✓ 등록 화면과 동일한 UI 사용<br>✓ 변경사항 즉시 반영<br>✓ 수정 이력 로깅|

#### FR-010: 일감 삭제

|Attribute|Details|
|---|---|
|**Priority**|P1 (High)|
|**User Story**|사용자로서, 마감된 일감이나 취소된 일감을 삭제하고 싶다|
|**Input**|일감 선택, 삭제 확인|
|**Processing**|Jobs 문서의 status를 'deleted'로 변경 (소프트 삭제)|
|**Output**|일감이 목록에서 제거됨|
|**Business Rules**|- 실제 삭제가 아닌 status 변경 (데이터 보존)<br>- 삭제 시 다른 사용자에게는 더 이상 노출되지 않음<br>- 대화는 유지되지만 접근 불가|
|**Error Handling**|- 삭제 전 최종 확인 다이얼로그<br>- 네트워크 오류 시 재시도 옵션|
|**Dependencies**|FR-007 (일감 등록)|
|**Acceptance Criteria**|✓ 스와이프로 삭제 액션 접근<br>✓ 확인 다이얼로그에서 취소 가능<br>✓ 삭제 후 복구 불가 안내|

### 2.3 Job Discovery (일감 찾기)

#### FR-011: 일감 목록 조회 (일감 찾기)

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical)|
|**User Story**|사용자로서, 내 위치 근처의 일감들을 거리순으로 보고 싶다|
|**Input**|메인 화면 "일감 찾기" 탭 접근, 위치 권한 허용|
|**Processing**|Firestore + Geohash로 위치 기반 쿼리, 거리 계산 및 정렬|
|**Output**|일감 카드 리스트 (작물명, 거리, 급여, 등록 시간)|
|**Business Rules**|- 기본 정렬: 거리순 (가까운 순)<br>- status='active'인 일감만 표시<br>- 실시간 업데이트<br>- 무한 스크롤 (20개씩 로드)<br>- **내가 등록한 일감은 제외**|
|**Error Handling**|- 위치 권한 거부 시 전체 일감 표시 (거리 정보 없음)<br>- 일감이 없으면 "근처에 일감이 없습니다" 표시<br>- 네트워크 오류 시 캐시된 데이터 표시|
|**Dependencies**|FR-007 (일감 등록), GeoFlutterFire|
|**Acceptance Criteria**|✓ 위치 권한 요청이 명확<br>✓ 거리 정보가 정확 (오차 ±100m 이내)<br>✓ 스크롤 시 추가 로드가 부드러움|

#### FR-012: 지도 뷰

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical)|
|**User Story**|사용자로서, 지도에서 일감 위치를 시각적으로 확인하고 싶다|
|**Input**|지도 뷰 탭 선택|
|**Processing**|Google Maps에 일감 위치를 마커로 표시|
|**Output**|지도 + 일감 마커 (작물별 아이콘)|
|**Business Rules**|- 현재 위치 중심으로 지도 표시<br>- 마커 클릭 시 미니 카드 팝업<br>- 미니 카드에서 "상세보기" 버튼<br>- 줌 레벨 조정 가능|
|**Error Handling**|- 위치 권한 거부 시 기본 위치 (서울) 표시<br>- 마커가 너무 많으면 클러스터링|
|**Dependencies**|FR-007 (일감 등록), Google Maps API|
|**Acceptance Criteria**|✓ 마커가 작물 종류에 따라 다른 아이콘 사용<br>✓ 지도 조작이 부드러움 (60fps)<br>✓ 미니 카드에 핵심 정보만 표시|

#### FR-013: 필터링

|Attribute|Details|
|---|---|
|**Priority**|P1 (High)|
|**User Story**|사용자로서, 내가 원하는 작물, 거리, 급여 조건으로 일감을 필터링하고 싶다|
|**Input**|필터 버튼 클릭, 조건 선택 (작물, 거리, 최소 급여)|
|**Processing**|클라이언트 사이드 필터링 (이미 로드된 데이터) 또는 새 쿼리|
|**Output**|필터링된 일감 목록|
|**Business Rules**|- 거리: 5km / 10km / 20km / 전체<br>- 작물: 다중 선택 가능<br>- 급여: 최소 금액 슬라이더<br>- 필터 조합 가능<br>- 필터 초기화 버튼 제공|
|**Error Handling**|- 필터 결과가 없으면 "조건에 맞는 일감이 없습니다" 표시<br>- 필터 초기화 유도|
|**Dependencies**|FR-011 (일감 목록 조회)|
|**Acceptance Criteria**|✓ 필터 UI가 직관적<br>✓ 필터 적용 시 즉시 반영 (<1초)<br>✓ 현재 적용된 필터가 명확히 표시|

#### FR-014: 검색

|Attribute|Details|
|---|---|
|**Priority**|P2 (Medium)|
|**User Story**|사용자로서, 특정 작물이나 지역명으로 빠르게 검색하고 싶다|
|**Input**|검색바에 키워드 입력 (작물명, 지역명)|
|**Processing**|Firestore 쿼리 또는 클라이언트 사이드 검색|
|**Output**|검색 결과 일감 목록|
|**Business Rules**|- 작물명, 일감 제목, 지역명에서 검색<br>- 부분 일치 지원<br>- 최근 검색어 저장 (최대 10개)|
|**Error Handling**|- 검색 결과 없음 시 "검색 결과가 없습니다" 표시<br>- 네트워크 오류 시 로컬 캐시에서 검색|
|**Dependencies**|FR-011 (일감 목록 조회)|
|**Acceptance Criteria**|✓ 타이핑 중 실시간 검색 (디바운스 500ms)<br>✓ 검색 결과가 관련성 높은 순으로 정렬<br>✓ 최근 검색어 탭으로 빠른 재검색|

#### FR-015: 일감 상세 보기

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical)|
|**User Story**|사용자로서, 일감의 모든 정보를 자세히 확인하고 메시지를 보내고 싶다|
|**Input**|일감 카드 클릭|
|**Processing**|Jobs 문서 조회|
|**Output**|일감 상세 화면 (모든 정보 표시)|
|**Business Rules**|- 표시 정보: 작물명, 위치(지도), 거리, 일감 기간, 급여, 일감 내용, 사진, 등록자 닉네임, 등록 시간<br>- 하단에 "메시지 보내기" CTA 버튼<br>- 신고하기 버튼 (우측 상단)<br>- 지도에서 위치 보기 버튼|
|**Error Handling**|- 일감이 삭제되었으면 "일감을 찾을 수 없습니다" 표시<br>- 이미지 로드 실패 시 placeholder|
|**Dependencies**|FR-007 (일감 등록), FR-011 (일감 목록 조회)|
|**Acceptance Criteria**|✓ 모든 정보가 가독성 있게 표시<br>✓ CTA 버튼이 항상 보임 (sticky)|

### 2.4 Messaging System (Core Feature)

#### FR-016A: 메시지 대화 시작하기

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical, Week 3)|
|**User Story**|사용자로서, 관심 있는 일감에 대해 작성자에게 메시지 보내기|
|**Input**|일감 상세 화면에서 "메시지 보내기" 버튼 클릭|
|**Processing**|1:1 대화방 생성 (없으면) 또는 기존 대화방 진입, 텍스트 입력 및 전송, 선택형 답변 버튼 표시|
|**Output**|대화방에서 텍스트 입력 및 전송 가능, 상대방에게 푸시 알림 발송|
|**Business Rules**|- 일감당 하나의 대화방만 생성 (중복 방지)<br>- 메시지 길이 제한: 500자<br>- Rate Limiting: 사용자당 하루 20개 일감에만 메시지 가능<br>- 일감 status='deleted' 시 메시지 전송 불가<br>- **자신이 등록한 일감에는 메시지 불가**|
|**Error Handling**|- 중복 대화방 생성 시도: 기존 대화방으로 이동<br>- 메시지 길이 초과: "메시지는 500자 이내로 입력해주세요"<br>- Rate Limit 초과: "오늘은 더 이상 메시지를 보낼 수 없습니다"<br>- 네트워크 오류: 재시도 옵션|
|**Dependencies**|FR-015 (일감 상세 보기), Cloud Function: `sendMessageNotification`|
|**Acceptance Criteria**|✓ 일감 상세 화면에 "메시지 보내기" 버튼 표시<br>✓ 버튼 클릭 시 1:1 대화방 생성 (없으면) 또는 기존 대화방 진입<br>✓ 대화방에서 텍스트 입력 및 전송 가능<br>✓ 선택형 답변 버튼 표시 (QuickReplies)<br>✓ 전송 성공 시 메시지 목록에 추가<br>✓ 상대방에게 푸시 알림 발송|

#### FR-017A: 메시지 수신 및 실시간 업데이트

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical, Week 3)|
|**User Story**|사용자로서, 상대방이 보낸 메시지를 실시간으로 받기|
|**Input**|대화방 진입 또는 앱 백그라운드 상태|
|**Processing**|Firestore snapshots() 리스너로 실시간 메시지 업데이트, FCM 푸시 알림 수신|
|**Output**|새 메시지 실시간 업데이트, 푸시 알림 클릭 시 해당 대화방으로 이동, 읽지 않은 메시지 카운트 표시|
|**Business Rules**|- 대화방 진입 시 기존 메시지 목록 로드<br>- 새 메시지 실시간 업데이트 (Firestore listener)<br>- 앱 백그라운드 시 푸시 알림 수신<br>- 읽지 않은 메시지 카운트 표시 (대화 목록)|
|**Error Handling**|- Firestore 연결 실패: 오프라인 모드로 전환<br>- 푸시 알림 수신 실패: 앱 내 알림 센터로 대체<br>- 메시지 로드 실패: 재시도 옵션|
|**Dependencies**|FR-016A (메시지 전송), Cloud Function: `sendMessageNotification`|
|**Acceptance Criteria**|✓ 대화방 진입 시 기존 메시지 목록 로드<br>✓ 새 메시지 실시간 업데이트 (Firestore listener)<br>✓ 앱 백그라운드 시 푸시 알림 수신<br>✓ 푸시 알림 클릭 시 해당 대화방으로 이동<br>✓ 읽지 않은 메시지 카운트 표시 (대화 목록)|

#### FR-018A: 선택형 답변 (QuickReplies)

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical, Week 4)|
|**User Story**|타이핑이 어려운 사용자로서, 미리 준비된 답변 버튼을 눌러서 빠르게 응답|
|**Input**|대화방 입력창 위의 선택형 답변 버튼 클릭|
|**Processing**|버튼 클릭 시 해당 텍스트가 메시지로 전송, 대화 컨텍스트에 맞는 답변 옵션 표시|
|**Output**|가로 스크롤 가능한 답변 버튼 (3-5개), 버튼 클릭 시 즉시 메시지 전송|
|**Business Rules**|- 일감 작성자용 답변: "가능합니다", "시간 조율 필요", "불가능합니다", "급여 협의 필요"<br>- 일감 참여자용 답변: "언제 시작하나요?", "급여가 얼마인가요?", "일감 기간이 어떻게 되나요?"<br>- 대화 단계에 따라 다른 옵션 표시 (초기 문의 vs 조건 협의)|
|**Error Handling**|- 버튼 클릭 실패: 재시도 옵션<br>- 메시지 전송 실패: 에러 메시지 표시|
|**Dependencies**|FR-016A (메시지 전송)|
|**Acceptance Criteria**|✓ 대화방 입력창 위에 선택형 답변 버튼 표시<br>✓ 버튼 클릭 시 해당 텍스트가 메시지로 전송<br>✓ 대화 컨텍스트에 맞는 답변 옵션 표시<br>✓ 가로 스크롤 가능 (3-5개 옵션)|

#### FR-019A: 대화 목록 조회

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical, Week 4)|
|**User Story**|사용자로서, 내가 진행 중인 모든 대화 목록 보기|
|**Input**|홈 화면 하단 탭의 "대화" 탭 선택|
|**Processing**|Conversations Collection에서 participants에 현재 사용자 포함된 대화 조회, 최근 메시지 순 정렬|
|**Output**|대화 목록: 상대방 닉네임, 일감 제목, 마지막 메시지, 시간, 읽지 않은 메시지 카운트 뱃지|
|**Business Rules**|- 최근 메시지 순 정렬<br>- 각 항목: 상대방 닉네임, 일감 제목, 마지막 메시지, 시간<br>- 읽지 않은 메시지 카운트 뱃지 표시<br>- 항목 클릭 시 대화방 진입|
|**Error Handling**|- 대화가 없으면 "아직 대화가 없습니다" 메시지 + 일감 찾기 버튼<br>- 네트워크 오류 시 캐시된 데이터 표시|
|**Dependencies**|FR-016A (메시지 전송)|
|**Acceptance Criteria**|✓ 홈 화면 하단 탭에 "대화" 탭 추가<br>✓ 대화 목록: 최근 메시지 순 정렬<br>✓ 각 항목: 상대방 닉네임, 일감 제목, 마지막 메시지, 시간<br>✓ 읽지 않은 메시지 카운트 뱃지 표시<br>✓ 항목 클릭 시 대화방 진입|

#### FR-020A: AI 답변 생성 (Phase 2)

|Attribute|Details|
|---|---|
|**Priority**|P2 (Phase 2, Week 8+)|
|**User Story**|답변이 막막한 사용자로서, AI가 추천하는 답변 보기|
|**Input**|메시지 입력창의 "AI 답변 제안" 버튼 클릭|
|**Processing**|Cloud Function 호출 (OpenAI API), 대화 컨텍스트 기반 3개 답변 옵션 생성|
|**Output**|3개의 답변 옵션 표시, 옵션 선택 시 입력창에 채워짐 (수정 가능)|
|**Business Rules**|- OpenAI API 비용: 개발 일정 전 확인 필요<br>- Rate Limiting: 사용자당 하루 10회<br>- 대화 컨텍스트 최대 5개 메시지만 전송 (비용 절감)|
|**Error Handling**|- API 호출 실패: "AI 답변 생성에 실패했습니다"<br>- Rate Limit 초과: "오늘은 더 이상 AI 답변을 요청할 수 없습니다"<br>- 네트워크 오류: 재시도 옵션|
|**Dependencies**|Cloud Function: `generateAIReply`, OpenAI API|
|**Acceptance Criteria**|✓ 메시지 입력창에 "AI 답변 제안" 버튼<br>✓ 버튼 클릭 시 Cloud Function 호출 (OpenAI API)<br>✓ 3개의 답변 옵션 표시<br>✓ 옵션 선택 시 입력창에 채워짐 (수정 가능)|

#### FR-021A: 메시지 저장 및 히스토리 (Phase 3+)

|Attribute|Details|
|---|---|
|**Priority**|P2 (Phase 3, 출시 후 3개월)|
|**User Story**|사용자로서, 과거 대화 내용 다시 보기|
|**Input**|대화방 스크롤 시 과거 메시지 페이지네이션 로드|
|**Processing**|Firestore 쿼리: `startAfter()` 사용 페이지네이션, 메시지 검색 기능|
|**Output**|과거 메시지 페이지네이션 로드, 메시지 검색 기능, 대화방별 메시지 보관 기간 설정 (기본 30일)|
|**Business Rules**|- v1.0에서는 실시간 메시지만 지원<br>- 앱 재시작 시 메시지 히스토리 없음<br>- Phase 3에서 저장 기능 추가|
|**Error Handling**|- 메시지 로드 실패: 재시도 옵션<br>- 검색 결과 없음: "검색 결과가 없습니다"|
|**Dependencies**|Firestore 페이지네이션, Cloud Scheduler (오래된 메시지 자동 삭제)|
|**Acceptance Criteria**|✓ 대화방 스크롤 시 과거 메시지 페이지네이션 로드<br>✓ 메시지 검색 기능<br>✓ 대화방별 메시지 보관 기간 설정 (기본 30일)|

### 2.5 Contract System (계약서 시스템 - 신규)

#### FR-030: 계약서 생성 및 작성

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical, Week 4)|
|**User Story**|사용자로서, 대화 중 합의된 조건을 계약서로 작성하고 싶다|
|**Input**|대화방에서 "계약서 작성" 버튼 클릭, 계약 조건 입력|
|**Processing**|Contracts Collection에 새 문서 생성, 일감 정보 자동 입력|
|**Output**|계약서 작성 화면, 미리보기 및 전송|
|**Business Rules**|- 계약 항목: 일감 제목, 작업 기간, 급여, 작업 내용, 특이사항<br>- 일감 정보 자동 입력<br>- 작성자만 계약서 생성 가능<br>- 대화방당 1개의 활성 계약서만 가능|
|**Error Handling**|- 필수 항목 미입력 시 저장 불가<br>- 이미 활성 계약서 있으면 경고|
|**Dependencies**|FR-016A (메시지 대화), FR-007 (일감 등록)|
|**Acceptance Criteria**|✓ 대화방에 "계약서 작성" 버튼 표시<br>✓ 일감 정보 자동 입력<br>✓ 미리보기 기능<br>✓ 계약서가 메시지로 전송됨|

#### FR-031: 계약서 서명

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical, Week 4)|
|**User Story**|사용자로서, 계약 내용을 확인하고 동의 서명하고 싶다|
|**Input**|계약서 메시지에서 "서명하기" 버튼 클릭, 동의 체크박스|
|**Processing**|Contracts 문서의 해당 사용자 서명 필드 업데이트|
|**Output**|서명 완료 표시, 양측 서명 완료 시 계약 확정|
|**Business Rules**|- 양측 모두 서명 필요<br>- 서명 순서 무관<br>- 양측 서명 완료 시 일감 상태 `active` → `contracted` 전환<br>- 서명 후 계약 내용 수정 불가|
|**Error Handling**|- 동의 미체크 시 서명 불가<br>- 네트워크 오류 시 재시도|
|**Dependencies**|FR-030 (계약서 생성)|
|**Acceptance Criteria**|✓ 계약서 내용 명확히 표시<br>✓ 동의 체크박스 필수<br>✓ 서명 상태 실시간 업데이트<br>✓ 양측 서명 완료 시 일감 상태 변경|

#### FR-032: 계약 상태 관리

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical, Week 4)|
|**User Story**|사용자로서, 계약 진행 상태를 확인하고 싶다|
|**Input**|일감 상세 또는 대화방에서 계약 상태 확인|
|**Processing**|Contracts 문서 조회|
|**Output**|계약 상태 표시 (대기중/작성자 서명/양측 서명 완료)|
|**Business Rules**|- 상태: pending / signed_by_creator / signed_by_both<br>- 양측 서명 완료 시 일감 상태 `contracted`로 변경<br>- 계약 취소 불가 (Phase 2 기능)|
|**Error Handling**|- 계약서 없으면 "계약서 없음" 표시|
|**Dependencies**|FR-030, FR-031|
|**Acceptance Criteria**|✓ 계약 상태가 명확히 표시<br>✓ 서명 대기 중인 사람 표시<br>✓ 양측 서명 완료 시 확정 표시|

### 2.6 Notifications

#### FR-022: 푸시 알림 수신 설정

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical)|
|**User Story**|사용자로서, 중요한 알림을 푸시로 받아 놓치지 않고 싶다|
|**Input**|앱 설치 후 푸시 알림 권한 요청|
|**Processing**|FCM 토큰 생성 및 UserProfile에 저장|
|**Output**|알림 권한 허용/거부|
|**Business Rules**|- 앱 최초 실행 시 권한 요청<br>- 거부 시 설정에서 재요청 안내<br>- FCM 토큰은 UserProfile.fcmToken에 저장<br>- 토큰 갱신 시 자동 업데이트|
|**Error Handling**|- 권한 거부 시 앱 내 알림 센터로 대체<br>- 토큰 생성 실패 시 재시도|
|**Dependencies**|Firebase Cloud Messaging|
|**Acceptance Criteria**|✓ 권한 요청 문구가 명확<br>✓ 거부 후에도 앱 기능 정상 동작<br>✓ 토큰이 정확히 저장됨|

#### FR-023: 새 메시지 알림

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical)|
|**User Story**|사용자로서, 새로운 메시지가 오면 즉시 알림을 받고 싶다|
|**Input**|상대방이 메시지 전송 시 트리거|
|**Processing**|Cloud Function에서 수신자의 FCM 토큰으로 푸시 알림 발송|
|**Output**|푸시 알림 (제목, 내용, 데이터 페이로드)|
|**Business Rules**|- 제목: "[상대방 닉네임]님의 메시지"<br>- 내용: 메시지 내용 (50자 제한)<br>- 데이터: type='new_message', conversationId<br>- 알림 탭 시 대화방으로 이동|
|**Error Handling**|- FCM 전송 실패 시 재시도 (최대 3회)<br>- 토큰 무효 시 UserProfile에서 제거|
|**Dependencies**|FR-016A (메시지 전송), FR-022 (푸시 알림 설정)|
|**Acceptance Criteria**|✓ 메시지 전송 후 5초 이내 알림 도착<br>✓ 알림 탭 시 정확한 화면으로 이동<br>✓ 포그라운드/백그라운드 모두 동작|

#### FR-024: 계약서 서명 알림

|Attribute|Details|
|---|---|
|**Priority**|P0 (Critical, Week 4)|
|**User Story**|사용자로서, 상대방이 계약서에 서명하면 알림을 받고 싶다|
|**Input**|상대방이 계약서 서명 시 트리거|
|**Processing**|Cloud Function에서 FCM 푸시 알림 발송|
|**Output**|푸시 알림 (제목, 내용)|
|**Business Rules**|- 제목: "계약서 서명 완료"<br>- 내용: 양측 서명 완료 여부에 따라 다름<br>- 알림 탭 시 계약서 화면으로 이동|
|**Error Handling**|- FCM 전송 실패 시 재시도<br>- 토큰 무효 시 처리|
|**Dependencies**|FR-031 (계약서 서명), FR-022|
|**Acceptance Criteria**|✓ 서명 후 5초 이내 알림 도착<br>✓ 알림 내용이 명확<br>✓ 알림 탭 시 계약서로 이동|

#### FR-025: 알림 센터

|Attribute|Details|
|---|---|
|**Priority**|P1 (High)|
|**User Story**|사용자로서, 과거에 받은 알림들을 다시 확인하고 싶다|
|**Input**|네비게이션의 "알림" 탭 선택|
|**Processing**|Events Collection에서 userId로 필터링하여 알림 목록 조회|
|**Output**|알림 카드 리스트 (제목, 내용, 시간, 읽음/안읽음 표시)|
|**Business Rules**|- 알림 타입별 구분: 메시지 / 계약서 / 시스템<br>- 최신순 정렬<br>- 읽음/안읽음 표시<br>- 알림 최대 보관 기간: 30일|
|**Error Handling**|- 알림이 없으면 빈 상태 화면<br>- 네트워크 오류 시 캐시된 데이터 표시|
|**Dependencies**|FR-023, FR-024|
|**Acceptance Criteria**|✓ 알림 센터가 직관적<br>✓ 알림 탭 시 관련 화면으로 이동<br>✓ 읽음 처리 자동화|

### 2.7 Reporting & Moderation

#### FR-026: 신고 기능

|Attribute|Details|
|---|---|
|**Priority**|P1 (High)|
|**User Story**|사용자로서, 부적절한 일감이나 사용자를 신고하여 플랫폼을 안전하게 유지하고 싶다|
|**Input**|신고 대상 선택 (일감/사용자/메시지), 신고 사유 선택, 상세 내용 입력(선택)|
|**Processing**|Reports Collection에 새 문서 생성|
|**Output**|신고 접수 완료 메시지|
|**Business Rules**|- 신고 타입: job / user / message<br>- 신고 사유: 허위 정보 / 스팸 / 부적절한 연락 / 기타<br>- 상세 내용: 500자 제한<br>- 동일 대상 중복 신고 가능 (악의적 반복 신고는 별도 처리)<br>- 신고 상태: pending / reviewed / resolved|
|**Error Handling**|- 네트워크 오류 시 재시도 옵션<br>- 신고 남용 시 경고 (하루 10건 이상)|
|**Dependencies**|None|
|**Acceptance Criteria**|✓ 신고 버튼이 명확히 보임<br>✓ 신고 사유가 명확히 분류됨<br>✓ 신고 후 즉시 확인 메시지 표시|

#### FR-027: 신고 자동 처리

|Attribute|Details|
|---|---|
|**Priority**|P1 (High)|
|**User Story**|시스템으로서, 일정 수 이상의 신고가 누적되면 자동으로 조치를 취하고 싶다|
|**Input**|신고 생성 시 트리거 (Cloud Function)|
|**Processing**|동일 대상의 신고 수 확인, 3건 이상 시 자동 조치|
|**Output**|조치 결과 (사용자 정지 / 일감 숨김) 및 로깅|
|**Business Rules**|- 신고 3건 누적 시 자동 조치<br>- 사용자 신고 → isActive=false 설정<br>- 일감 신고 → status='deleted' 설정<br>- 메시지 신고 → 대화방 차단<br>- 조치 사항은 이메일로 관리자에게 통보|
|**Error Handling**||