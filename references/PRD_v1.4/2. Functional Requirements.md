### 2.1 Authentication & User Management

#### FR-001: 전화번호 인증

| Attribute               | Details                                                                                                                                                                       |
| ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                                                                                 |
| **User Story**          | 사용자로서, 전화번호만으로 1분 내에 가입하여 서비스를 이용하고 싶다                                                                                                           |
| **Input**               | 전화번호 (+82 형식), SMS 인증 코드 (6자리)                                                                                                                                    |
| **Processing**          | Firebase Phone Authentication 사용, SMS 발송 및 검증                                                                                                                          |
| **Output**              | 인증 성공 시 역할 선택 화면으로 이동                                                                                                                                          |
| **Business Rules**      | - 중복 전화번호 가입 불가<br>- SMS 인증 코드 유효 시간: 5분<br>- 재전송 가능 횟수: 3회/일                                                                                     |
| **Error Handling**      | - 잘못된 코드 입력: "인증번호가 일치하지 않습니다"<br>- 만료된 코드: "인증번호가 만료되었습니다. 재전송 버튼을 눌러주세요"<br>- 네트워크 오류: "네트워크 연결을 확인해주세요" |
| **Dependencies**        | Firebase Authentication                                                                                                                                                       |
| **Acceptance Criteria** | ✓ 전화번호 입력 후 30초 내 SMS 수신<br>✓ 올바른 코드 입력 시 즉시 인증 완료<br>✓ 3회 오류 시 재전송 유도 메시지 표시                                                          |

#### FR-002: 역할 선택

| Attribute               | Details                                                                                                            |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------ |
| **Priority**            | P0 (Critical)                                                                                                      |
| **User Story**          | 신규 사용자로서, 농부 또는 작업자 중 역할을 선택하여 맞춤 화면을 보고 싶다                                         |
| **Input**               | 역할 선택 (농부 / 작업자)                                                                                          |
| **Processing**          | UserProfile 문서 생성, role 필드 저장                                                                              |
| **Output**              | 역할별 메인 화면으로 이동 (농부 → 작업 관리, 작업자 → 작업 탐색)                                                   |
| **Business Rules**      | - 가입 시 1회만 선택 가능<br>- 이후 변경 불가<br>- 닉네임 미입력 시 자동 생성 (농부123, 작업자456)                 |
| **Error Handling**      | - 역할 미선택 시 다음 단계 진행 불가                                                                               |
| **Dependencies**        | FR-001 (전화번호 인증 완료)                                                                                        |
| **Acceptance Criteria** | ✓ 토글 UI로 명확한 선택 가능<br>✓ 선택 후 즉시 해당 역할의 메인 화면 표시<br>✓ UserProfile에 role 필드 정확히 저장 |

#### FR-003: 약관 동의

| Attribute               | Details                                                                                            |
| ----------------------- | -------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                      |
| **User Story**          | 사용자로서, 최소한의 약관만 동의하고 빠르게 가입하고 싶다                                          |
| **Input**               | 필수 약관 동의 체크박스 (1개)                                                                      |
| **Processing**          | 동의 여부 확인 후 회원가입 진행                                                                    |
| **Output**              | 동의 완료 시 역할 선택 단계로 이동                                                                 |
| **Business Rules**      | - 필수 약관: "서비스 이용약관 동의" 1개만<br>- 선택 약관 없음<br>- 체크 필수 (미동의 시 진행 불가) |
| **Error Handling**      | - 미동의 시: "서비스 이용을 위해 약관 동의가 필요합니다"                                           |
| **Dependencies**        | None                                                                                               |
| **Acceptance Criteria** | ✓ 약관 전문 보기 링크 제공<br>✓ 체크박스 미선택 시 다음 버튼 비활성화                              |

#### FR-004: 사용자 프로필 관리

| Attribute               | Details                                                                                                                                       |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P1 (High)                                                                                                                                     |
| **User Story**          | 사용자로서, 내 기본 정보와 전화 가능 시간을 설정하고 싶다                                                                                     |
| **Input**               | 닉네임 (선택), 주요 활동 지역 (선택), 기본 전화 가능 시간 (선택)                                                                              |
| **Processing**          | UserProfile 문서 업데이트                                                                                                                     |
| **Output**              | 프로필 정보 저장 완료 메시지                                                                                                                  |
| **Business Rules**      | - 전화번호 변경 불가 (표시만)<br>- 닉네임 미입력 시 자동 생성 유지<br>- 지역은 시/군 단위<br>- 기본 전화 가능 시간은 작업 등록 시 자동 입력됨 |
| **Error Handling**      | - 네트워크 오류 시 재시도 옵션 제공                                                                                                           |
| **Dependencies**        | FR-002 (역할 선택 완료)                                                                                                                       |
| **Acceptance Criteria** | ✓ 모든 필드가 선택 사항으로 표시<br>✓ 저장 시 즉시 반영<br>✓ 전화번호 필드는 비활성화 상태                                                    |

#### FR-005: 로그아웃

| Attribute               | Details                                                               |
| ----------------------- | --------------------------------------------------------------------- |
| **Priority**            | P2 (Medium)                                                           |
| **User Story**          | 사용자로서, 필요 시 로그아웃하여 계정을 보호하고 싶다                 |
| **Input**               | 로그아웃 버튼 클릭                                                    |
| **Processing**          | Firebase Authentication 로그아웃, 로컬 캐시 삭제                      |
| **Output**              | 로그인 화면으로 이동                                                  |
| **Business Rules**      | - 로그아웃 시 재로그인 필요<br>- 로컬 데이터는 유지 (오프라인 접근용) |
| **Error Handling**      | - 네트워크 오류 시에도 로컬 세션 종료                                 |
| **Dependencies**        | None                                                                  |
| **Acceptance Criteria** | ✓ 로그아웃 확인 다이얼로그 표시<br>✓ 로그아웃 후 로그인 화면으로 이동 |

#### FR-006: 회원 탈퇴

| Attribute               | Details                                                                                                     |
| ----------------------- | ----------------------------------------------------------------------------------------------------------- |
| **Priority**            | P2 (Medium)                                                                                                 |
| **User Story**          | 사용자로서, 서비스가 필요 없을 때 내 정보를 완전히 삭제하고 싶다                                            |
| **Input**               | 회원 탈퇴 버튼 클릭, 최종 확인                                                                              |
| **Processing**          | UserProfile, 관련 데이터 삭제, Firebase Auth 계정 삭제                                                      |
| **Output**              | 탈퇴 완료 메시지, 로그인 화면으로 이동                                                                      |
| **Business Rules**      | - 등록한 작업이 있으면 "작업 마감 후 탈퇴 가능" 안내<br>- 탈퇴 시 모든 데이터 즉시 삭제<br>- 복구 불가 경고 |
| **Error Handling**      | - 진행 중인 작업이 있으면 탈퇴 차단<br>- 네트워크 오류 시 재시도 옵션                                       |
| **Dependencies**        | None                                                                                                        |
| **Acceptance Criteria** | ✓ 2단계 확인 (탈퇴 의사 재확인)<br>✓ 탈퇴 후 동일 번호로 재가입 가능<br>✓ 모든 개인정보 완전 삭제 확인      |

### 2.2 Job Management (Farmer)

#### FR-007: 작업 등록

| Attribute               | Details                                                                                                                                                                                                                                                                                       |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                                                                                                                                                                                                 |
| **User Story**          | 농부로서, 3분 내에 간단하게 인력이 필요한 작업을 등록하고 싶다                                                                                                                                                                                                                                |
| **Input**               | 작물 선택, 작업 내용, 작업 기간, 급여 정보, 위치, 전화 가능 시간, 사진(선택), 상세설명(선택)                                                                                                                                                                                                  |
| **Processing**          | Jobs Collection에 새 문서 생성, farmerId 및 메타데이터 저장                                                                                                                                                                                                                                   |
| **Output**              | 작업 등록 완료, 농부 메인 화면의 작업 목록에 표시                                                                                                                                                                                                                                             |
| **Business Rules**      | - 작물: 12개 주요 작물 중 선택 (드롭다운)<br>- 작업 내용: 100자 제한<br>- 급여: 일당/시급 선택 후 금액 입력<br>- 위치: 지도에서 핀으로 지정<br>- 전화 가능 시간: 시작~종료 시간 (24시간 형식)<br>- 전화번호: 사용자 번호 자동 입력 (수정 가능)<br>- 사진: 최대 3장<br>- 상세 설명: 500자 제한 |
| **Error Handling**      | - 필수 필드 미입력 시 등록 불가<br>- 위치 권한 거부 시 안내 메시지<br>- 이미지 업로드 실패 시 재시도 옵션                                                                                                                                                                                     |
| **Dependencies**        | FR-002 (농부 역할 선택), Google Maps API                                                                                                                                                                                                                                                      |
| **Acceptance Criteria** | ✓ 5단계 스텝 진행 (작물 선택 → 정보 입력 → 위치 → 시간 → 미리보기)<br>✓ 각 단계 30초 이내 완료 가능<br>✓ 등록 즉시 작업자에게 노출                                                                                                                                                            |

#### FR-008: 작업 목록 조회 (농부)

| Attribute               | Details                                                                                                                     |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                               |
| **User Story**          | 농부로서, 내가 등록한 작업들을 한눈에 보고 관리하고 싶다                                                                    |
| **Input**               | 농부 메인 화면 접근                                                                                                         |
| **Processing**          | Firestore에서 farmerId로 필터링하여 작업 목록 조회                                                                          |
| **Output**              | 작업 카드 리스트 (작물명, 기간, 연락 요청 수, 신규 요청 뱃지)                                                               |
| **Business Rules**      | - 최신 등록순 정렬<br>- 신규 연락 요청이 있으면 빨간 뱃지 표시<br>- 작업당 연락 요청 수 표시<br>- 스와이프로 수정/삭제 가능 |
| **Error Handling**      | - 작업이 없으면 빈 상태 화면 표시<br>- 네트워크 오류 시 캐시된 데이터 표시                                                  |
| **Dependencies**        | FR-007 (작업 등록)                                                                                                          |
| **Acceptance Criteria** | ✓ 작업 카드에 핵심 정보만 표시<br>✓ 신규 요청 뱃지가 실시간 업데이트<br>✓ 스와이프 액션이 직관적                            |

#### FR-009: 작업 수정

| Attribute               | Details                                                                                      |
| ----------------------- | -------------------------------------------------------------------------------------------- |
| **Priority**            | P1 (High)                                                                                    |
| **User Story**          | 농부로서, 등록한 작업 정보가 변경되면 수정하고 싶다                                          |
| **Input**               | 작업 선택, 수정할 필드 변경                                                                  |
| **Processing**          | Jobs 문서 업데이트                                                                           |
| **Output**              | 수정 완료 메시지, 작업 목록에 반영                                                           |
| **Business Rules**      | - 모든 필드 수정 가능<br>- 이미 보낸 연락 요청에는 영향 없음<br>- 수정 시간 기록 (updatedAt) |
| **Error Handling**      | - 네트워크 오류 시 재시도 옵션<br>- 동시 수정 충돌 방지 (낙관적 잠금)                        |
| **Dependencies**        | FR-007 (작업 등록)                                                                           |
| **Acceptance Criteria** | ✓ 등록 화면과 동일한 UI 사용<br>✓ 변경사항 즉시 반영<br>✓ 수정 이력 로깅                     |

#### FR-010: 작업 삭제

| Attribute               | Details                                                                                                                            |
| ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P1 (High)                                                                                                                          |
| **User Story**          | 농부로서, 마감된 작업이나 취소된 작업을 삭제하고 싶다                                                                              |
| **Input**               | 작업 선택, 삭제 확인                                                                                                               |
| **Processing**          | Jobs 문서의 status를 'deleted'로 변경 (소프트 삭제)                                                                                |
| **Output**              | 작업이 목록에서 제거됨                                                                                                             |
| **Business Rules**      | - 실제 삭제가 아닌 status 변경 (데이터 보존)<br>- 삭제 시 작업자에게는 더 이상 노출되지 않음<br>- 연락 요청은 유지되지만 접근 불가 |
| **Error Handling**      | - 삭제 전 최종 확인 다이얼로그<br>- 네트워크 오류 시 재시도 옵션                                                                   |
| **Dependencies**        | FR-007 (작업 등록)                                                                                                                 |
| **Acceptance Criteria** | ✓ 스와이프로 삭제 액션 접근<br>✓ 확인 다이얼로그에서 취소 가능<br>✓ 삭제 후 복구 불가 안내                                         |

### 2.3 Job Discovery (Worker)

#### FR-011: 작업 목록 조회 (작업자)

| Attribute               | Details                                                                                                                                       |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                                                 |
| **User Story**          | 작업자로서, 내 위치 근처의 작업들을 거리순으로 보고 싶다                                                                                      |
| **Input**               | 작업자 메인 화면 접근, 위치 권한 허용                                                                                                         |
| **Processing**          | Firestore + Geohash로 위치 기반 쿼리, 거리 계산 및 정렬                                                                                       |
| **Output**              | 작업 카드 리스트 (작물명, 거리, 급여, 전화 가능 시간, 등록 시간)                                                                              |
| **Business Rules**      | - 기본 정렬: 거리순 (가까운 순)<br>- status='active'인 작업만 표시<br>- 실시간 업데이트<br>- 무한 스크롤 (20개씩 로드)                        |
| **Error Handling**      | - 위치 권한 거부 시 전체 작업 표시 (거리 정보 없음)<br>- 작업이 없으면 "근처에 작업이 없습니다" 표시<br>- 네트워크 오류 시 캐시된 데이터 표시 |
| **Dependencies**        | FR-007 (작업 등록), GeoFlutterFire                                                                                                            |
| **Acceptance Criteria** | ✓ 위치 권한 요청이 명확<br>✓ 거리 정보가 정확 (오차 ±100m 이내)<br>✓ 스크롤 시 추가 로드가 부드러움                                           |

#### FR-012: 지도 뷰

| Attribute               | Details                                                                                                                   |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                             |
| **User Story**          | 작업자로서, 지도에서 작업 위치를 시각적으로 확인하고 싶다                                                                 |
| **Input**               | 지도 뷰 탭 선택                                                                                                           |
| **Processing**          | Google Maps에 작업 위치를 마커로 표시                                                                                     |
| **Output**              | 지도 + 작업 마커 (작물별 아이콘)                                                                                          |
| **Business Rules**      | - 현재 위치 중심으로 지도 표시<br>- 마커 클릭 시 미니 카드 팝업<br>- 미니 카드에서 "상세보기" 버튼<br>- 줌 레벨 조정 가능 |
| **Error Handling**      | - 위치 권한 거부 시 기본 위치 (서울) 표시<br>- 마커가 너무 많으면 클러스터링                                              |
| **Dependencies**        | FR-007 (작업 등록), Google Maps API                                                                                       |
| **Acceptance Criteria** | ✓ 마커가 작물 종류에 따라 다른 아이콘 사용<br>✓ 지도 조작이 부드러움 (60fps)<br>✓ 미니 카드에 핵심 정보만 표시            |

#### FR-013: 필터링

| Attribute               | Details                                                                                                                                 |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P1 (High)                                                                                                                               |
| **User Story**          | 작업자로서, 내가 원하는 작물, 거리, 급여 조건으로 작업을 필터링하고 싶다                                                                |
| **Input**               | 필터 버튼 클릭, 조건 선택 (작물, 거리, 최소 급여)                                                                                       |
| **Processing**          | 클라이언트 사이드 필터링 (이미 로드된 데이터) 또는 새 쿼리                                                                              |
| **Output**              | 필터링된 작업 목록                                                                                                                      |
| **Business Rules**      | - 거리: 5km / 10km / 20km / 전체<br>- 작물: 다중 선택 가능<br>- 급여: 최소 금액 슬라이더<br>- 필터 조합 가능<br>- 필터 초기화 버튼 제공 |
| **Error Handling**      | - 필터 결과가 없으면 "조건에 맞는 작업이 없습니다" 표시<br>- 필터 초기화 유도                                                           |
| **Dependencies**        | FR-011 (작업 목록 조회)                                                                                                                 |
| **Acceptance Criteria** | ✓ 필터 UI가 직관적<br>✓ 필터 적용 시 즉시 반영 (<1초)<br>✓ 현재 적용된 필터가 명확히 표시                                               |

#### FR-014: 검색

| Attribute               | Details                                                                                                               |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P2 (Medium)                                                                                                           |
| **User Story**          | 작업자로서, 특정 작물이나 지역명으로 빠르게 검색하고 싶다                                                             |
| **Input**               | 검색바에 키워드 입력 (작물명, 지역명)                                                                                 |
| **Processing**          | Firestore 쿼리 또는 클라이언트 사이드 검색                                                                            |
| **Output**              | 검색 결과 작업 목록                                                                                                   |
| **Business Rules**      | - 작물명, 작업 제목, 지역명에서 검색<br>- 부분 일치 지원<br>- 최근 검색어 저장 (최대 10개)                            |
| **Error Handling**      | - 검색 결과 없음 시 "검색 결과가 없습니다" 표시<br>- 네트워크 오류 시 로컬 캐시에서 검색                              |
| **Dependencies**        | FR-011 (작업 목록 조회)                                                                                               |
| **Acceptance Criteria** | ✓ 타이핑 중 실시간 검색 (디바운스 500ms)<br>✓ 검색 결과가 관련성 높은 순으로 정렬<br>✓ 최근 검색어 탭으로 빠른 재검색 |

#### FR-015: 작업 상세 보기 (작업자)

| Attribute               | Details                                                                                                                                                                                                                   |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                                                                                                                             |
| **User Story**          | 작업자로서, 작업의 모든 정보를 자세히 확인하고 관심 표시를 하고 싶다                                                                                                                                                      |
| **Input**               | 작업 카드 클릭                                                                                                                                                                                                            |
| **Processing**          | Jobs 문서 조회                                                                                                                                                                                                            |
| **Output**              | 작업 상세 화면 (모든 정보 표시)                                                                                                                                                                                           |
| **Business Rules**      | - 표시 정보: 작물명, 위치(지도), 거리, 작업 기간, 급여, 농부 전화 가능 시간, 작업 내용, 사진, 등록자 닉네임, 등록 시간<br>- 하단에 "연락하고 싶어요" CTA 버튼<br>- 신고하기 버튼 (우측 상단)<br>- 지도에서 위치 보기 버튼 |
| **Error Handling**      | - 작업이 삭제되었으면 "작업을 찾을 수 없습니다" 표시<br>- 이미지 로드 실패 시 placeholder                                                                                                                                 |
| **Dependencies**        | FR-007 (작업 등록), FR-011 (작업 목록 조회)                                                                                                                                                                               |
| **Acceptance Criteria** | ✓ 모든 정보가 가독성 있게 표시<br>✓ 농부 전화 가능 시간이 강조 표시<br>✓ CTA 버튼이 항상 보임 (sticky)                                                                                                                    |

### 2.4 Contact Request System (Core Feature)

#### FR-016: 연락 요청 전송 (작업자)

| Attribute               | Details                                                                                                                                                                                                                                                                                                   |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                                                                                                                                                                                                             |
| **User Story**          | 작업자로서, 관심있는 작업에 내 연락처를 제공하고 농부의 수락을 기다리고 싶다                                                                                                                                                                                                                              |
| **Input**               | "연락하고 싶어요" 버튼 클릭, 내 전화 가능 시간, 한마디 메시지(선택), 동의 체크                                                                                                                                                                                                                            |
| **Processing**          | ContactRequests Collection에 새 문서 생성, 작업자 정보 저장, 농부에게 푸시 알림 발송                                                                                                                                                                                                                      |
| **Output**              | 요청 전송 완료 메시지, 알림 대기 안내                                                                                                                                                                                                                                                                     |
| **Business Rules**      | - 동일 작업에 1회만 요청 가능<br>- 하루 최대 20건 요청 제한<br>- 전화번호 자동 입력 (수정 가능)<br>- 전화 가능 시간 필수 입력<br>- 한마디 메시지: 50자 제한<br>- 필수 동의: "내 전화번호를 농부에게 제공하고, 농부가 수락하면 농부 번호를 받는 것에 동의"<br>- 요청 상태: 'pending'<br>- 7일 후 자동 만료 |
| **Error Handling**      | - 중복 요청: "이미 연락 요청을 보냈습니다"<br>- 하루 제한 초과: "오늘은 더 이상 요청을 보낼 수 없습니다 (내일 다시 시도)"<br>- 동의 미체크: "동의가 필요합니다"<br>- 네트워크 오류: 재시도 옵션                                                                                                           |
| **Dependencies**        | FR-015 (작업 상세 보기)                                                                                                                                                                                                                                                                                   |
| **Acceptance Criteria** | ✓ 요청 다이얼로그가 명확하고 간결<br>✓ 동의 문구가 법적으로 명확<br>✓ 전송 즉시 농부에게 푸시 알림 발송<br>✓ 요청 후 버튼이 "요청 보냄"으로 변경되어 비활성화                                                                                                                                             |

#### FR-017: 연락 요청 목록 조회 (농부)

| Attribute               | Details                                                                                                                                                                                       |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                                                                                                 |
| **User Story**          | 농부로서, 내 작업에 관심있는 작업자들의 정보를 확인하고 선택하고 싶다                                                                                                                         |
| **Input**               | 작업 카드의 "연락 요청 확인" 버튼 클릭 또는 알림에서 진입                                                                                                                                     |
| **Processing**          | ContactRequests Collection에서 farmerId + jobId로 필터링                                                                                                                                      |
| **Output**              | 작업자 카드 리스트 (전화번호, 가능 시간, 메시지, 요청 시간, 신규 뱃지)                                                                                                                        |
| **Business Rules**      | - 최신 요청순 정렬<br>- 신규 요청(미확인)은 상단 + 뱃지 표시<br>- 각 카드에 "연락하기" / "나중에" 버튼<br>- 작업자 전화번호 즉시 확인 가능<br>- 작업자 가능 시간 표시<br>- 작업자 메시지 표시 |
| **Error Handling**      | - 요청이 없으면 "아직 연락 요청이 없습니다" 표시<br>- 네트워크 오류 시 캐시된 데이터 표시                                                                                                     |
| **Dependencies**        | FR-016 (연락 요청 전송), FR-008 (작업 목록 조회)                                                                                                                                              |
| **Acceptance Criteria** | ✓ 신규 요청이 명확히 구분됨<br>✓ 작업자 정보가 한눈에 파악됨<br>✓ 스크롤 시 추가 로드 지원                                                                                                    |

#### FR-018: 연락 요청 수락 (농부)

| Attribute               | Details                                                                                                                                                                                                                           |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                                                                                                                                     |
| **User Story**          | 농부로서, 마음에 드는 작업자를 선택하여 내 연락처도 제공하고 서로 통화하고 싶다                                                                                                                                                   |
| **Input**               | "연락하기" 버튼 클릭, 동의 확인                                                                                                                                                                                                   |
| **Processing**          | ContactRequests 문서 업데이트 (status='accepted', farmerPhone 추가, farmerConsent=true), 작업자에게 푸시 알림 발송 (농부 번호 포함)                                                                                               |
| **Output**              | 연락처 교환 완료 메시지, 작업자 전화번호 표시, 전화 걸기 버튼                                                                                                                                                                     |
| **Business Rules**      | - 수락 전 동의 다이얼로그 표시: "내 전화번호를 작업자에게 제공하는 것에 동의"<br>- 수락 시 양방향 번호 동시 공개<br>- 농부 전화 가능 시간도 함께 전달<br>- 수락 시간 기록 (respondedAt)<br>- Job의 newContactRequests 카운트 감소 |
| **Error Handling**      | - 이미 수락된 요청: "이미 수락한 요청입니다"<br>- 네트워크 오류: 재시도 옵션<br>- 동의 미체크: "동의가 필요합니다"                                                                                                                |
| **Dependencies**        | FR-017 (연락 요청 목록 조회)                                                                                                                                                                                                      |
| **Acceptance Criteria** | ✓ 동의 다이얼로그가 명확<br>✓ 수락 즉시 작업자에게 푸시 알림 발송<br>✓ 수락 후 전화 걸기 버튼 제공<br>✓ 수락된 요청은 목록에서 "수락 완료" 표시                                                                                   |

#### FR-019: 연락 요청 거절 (농부)

| Attribute               | Details                                                                                                                                                                |
| ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P1 (High)                                                                                                                                                              |
| **User Story**          | 농부로서, 적합하지 않은 작업자의 요청을 정중히 거절하고 싶다                                                                                                           |
| **Input**               | "나중에" 버튼 클릭                                                                                                                                                     |
| **Processing**          | ContactRequests 문서 업데이트 (status='rejected')                                                                                                                      |
| **Output**              | 요청이 목록에서 제거됨 (또는 하단으로 이동)                                                                                                                            |
| **Business Rules**      | - 명시적 거절 알림은 작업자에게 발송하지 않음 (부정적 경험 방지)<br>- 거절된 요청은 농부 목록에서 숨김<br>- 작업자는 상태 변경을 알 수 없음 (pending 상태 유지로 보임) |
| **Error Handling**      | - 네트워크 오류: 재시도 옵션                                                                                                                                           |
| **Dependencies**        | FR-017 (연락 요청 목록 조회)                                                                                                                                           |
| **Acceptance Criteria** | ✓ "나중에" 버튼이 부드러운 표현 사용<br>✓ 거절 시 확인 다이얼로그 없음 (빠른 액션)<br>✓ 거절된 요청은 복구 불가                                                        |

#### FR-020: 연락 요청 현황 조회 (작업자)

| Attribute               | Details                                                                                                                                          |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Priority**            | P1 (High)                                                                                                                                        |
| **User Story**          | 작업자로서, 내가 보낸 연락 요청들의 상태를 확인하고 싶다                                                                                         |
| **Input**               | 작업자 메인 화면의 "내 연락 요청 현황" 메뉴                                                                                                      |
| **Processing**          | ContactRequests Collection에서 workerId로 필터링                                                                                                 |
| **Output**              | 요청 카드 리스트 (작업명, 상태, 요청 시간)                                                                                                       |
| **Business Rules**      | - 상태별 탭: 대기중 / 수락됨 / 만료됨<br>- 대기중: pending 상태<br>- 수락됨: accepted 상태 + 농부 번호 표시<br>- 만료됨: expired 상태 (7일 경과) |
| **Error Handling**      | - 요청이 없으면 "아직 보낸 요청이 없습니다" 표시<br>- 네트워크 오류 시 캐시된 데이터 표시                                                        |
| **Dependencies**        | FR-016 (연락 요청 전송)                                                                                                                          |
| **Acceptance Criteria** | ✓ 상태별 필터링이 명확<br>✓ 수락된 요청에서 농부 번호 및 통화 가능 시간 확인 가능<br>✓ 전화 걸기 버튼 제공                                       |

#### FR-021: 연락 요청 자동 만료

| Attribute               | Details                                                                                                                         |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P1 (High)                                                                                                                       |
| **User Story**          | 시스템으로서, 오래된 미응답 요청을 자동으로 정리하여 데이터를 관리하고 싶다                                                     |
| **Input**               | Cloud Function 스케줄러 (매일 실행)                                                                                             |
| **Processing**          | expiresAt이 현재 시간보다 이전인 pending 요청의 status를 'expired'로 변경                                                       |
| **Output**              | 만료된 요청 수 로깅                                                                                                             |
| **Business Rules**      | - 요청 생성 시 expiresAt = createdAt + 7일<br>- 매일 자정 실행<br>- pending 상태만 만료 처리<br>- accepted/rejected 상태는 유지 |
| **Error Handling**      | - 실행 실패 시 로그 기록 및 재시도                                                                                              |
| **Dependencies**        | FR-016 (연락 요청 전송), Cloud Functions                                                                                        |
| **Acceptance Criteria** | ✓ 정확히 7일 후 만료<br>✓ 만료된 요청은 작업자 현황에서 "만료됨" 탭에 표시<br>✓ 만료 처리 성공률 99%+                           |

### 2.5 Notifications

#### FR-022: 푸시 알림 수신 설정

| Attribute               | Details                                                                                                                                   |
| ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                                             |
| **User Story**          | 사용자로서, 중요한 알림을 푸시로 받아 놓치지 않고 싶다                                                                                    |
| **Input**               | 앱 설치 후 푸시 알림 권한 요청                                                                                                            |
| **Processing**          | FCM 토큰 생성 및 UserProfile에 저장                                                                                                       |
| **Output**              | 알림 권한 허용/거부                                                                                                                       |
| **Business Rules**      | - 앱 최초 실행 시 권한 요청<br>- 거부 시 설정에서 재요청 안내<br>- FCM 토큰은 UserProfile.fcmToken에 저장<br>- 토큰 갱신 시 자동 업데이트 |
| **Error Handling**      | - 권한 거부 시 앱 내 알림 센터로 대체<br>- 토큰 생성 실패 시 재시도                                                                       |
| **Dependencies**        | Firebase Cloud Messaging                                                                                                                  |
| **Acceptance Criteria** | ✓ 권한 요청 문구가 명확<br>✓ 거부 후에도 앱 기능 정상 동작<br>✓ 토큰이 정확히 저장됨                                                      |

#### FR-023: 새 연락 요청 알림 (농부)

| Attribute               | Details                                                                                                                                                                            |
| ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                                                                                      |
| **User Story**          | 농부로서, 내 작업에 새로운 연락 요청이 오면 즉시 알림을 받고 싶다                                                                                                                  |
| **Input**               | 작업자가 연락 요청 전송 시 트리거                                                                                                                                                  |
| **Processing**          | Cloud Function에서 농부의 FCM 토큰으로 푸시 알림 발송                                                                                                                              |
| **Output**              | 푸시 알림 (제목, 내용, 데이터 페이로드)                                                                                                                                            |
| **Business Rules**      | - 제목: "새로운 연락 요청"<br>- 내용: "{작업명} 작업에 관심있는 작업자가 있어요"<br>- 데이터: type='new_contact_request', jobId, requestId<br>- 알림 탭 시 연락 요청 목록으로 이동 |
| **Error Handling**      | - FCM 전송 실패 시 재시도 (최대 3회)<br>- 토큰 무효 시 UserProfile에서 제거                                                                                                        |
| **Dependencies**        | FR-016 (연락 요청 전송), FR-022 (푸시 알림 설정)                                                                                                                                   |
| **Acceptance Criteria** | ✓ 요청 전송 후 5초 이내 알림 도착<br>✓ 알림 탭 시 정확한 화면으로 이동<br>✓ 포그라운드/백그라운드 모두 동작                                                                        |

#### FR-024: 연락처 교환 완료 알림 (작업자)

| Attribute               | Details                                                                                                                                                                                                                                                                                                   |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P0 (Critical)                                                                                                                                                                                                                                                                                             |
| **User Story**          | 작업자로서, 농부가 내 요청을 수락하면 즉시 알림을 받고 농부 번호를 확인하고 싶다                                                                                                                                                                                                                          |
| **Input**               | 농부가 연락 요청 수락 시 트리거                                                                                                                                                                                                                                                                           |
| **Processing**          | Cloud Function에서 작업자의 FCM 토큰으로 푸시 알림 발송 (농부 번호 포함)                                                                                                                                                                                                                                  |
| **Output**              | 푸시 알림 (제목, 내용, 농부 번호, 통화 가능 시간)                                                                                                                                                                                                                                                         |
| **Business Rules**      | - 제목: "연락처가 교환되었습니다!"<br>- 내용: "농부님 전화번호: {farmerPhone}"<br>- 추가 정보: "통화 가능: {farmerAvailableFrom}~{farmerAvailableTo}"<br>- 데이터: type='contact_accepted', requestId, farmerPhone, farmerAvailableFrom, farmerAvailableTo<br>- 알림 탭 시 알림 센터의 해당 알림으로 이동 |
| **Error Handling**      | - FCM 전송 실패 시 재시도 (최대 3회)<br>- 토큰 무효 시 UserProfile에서 제거                                                                                                                                                                                                                               |
| **Dependencies**        | FR-018 (연락 요청 수락), FR-022 (푸시 알림 설정)                                                                                                                                                                                                                                                          |
| **Acceptance Criteria** | ✓ 수락 후 5초 이내 알림 도착<br>✓ 알림에 농부 전화번호가 명확히 표시<br>✓ 알림 탭 시 전화 걸기 버튼이 있는 화면으로 이동                                                                                                                                                                                  |

#### FR-025: 알림 센터

| Attribute               | Details                                                                                                                                                     |
| ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P1 (High)                                                                                                                                                   |
| **User Story**          | 사용자로서, 과거에 받은 알림들을 다시 확인하고 전화번호를 찾고 싶다                                                                                         |
| **Input**               | 네비게이션의 "알림" 탭 선택                                                                                                                                 |
| **Processing**          | Events Collection에서 userId로 필터링하여 알림 목록 조회                                                                                                    |
| **Output**              | 알림 카드 리스트 (제목, 내용, 시간, 전화번호/전화 걸기 버튼)                                                                                                |
| **Business Rules**      | - 알림 타입별 구분: 연락 요청 / 교환 완료<br>- 최신순 정렬<br>- 읽음/안읽음 표시<br>- 교환 완료 알림에는 전화 걸기 버튼 제공<br>- 알림 최대 보관 기간: 30일 |
| **Error Handling**      | - 알림이 없으면 빈 상태 화면<br>- 네트워크 오류 시 캐시된 데이터 표시                                                                                       |
| **Dependencies**        | FR-023 (새 연락 요청 알림), FR-024 (교환 완료 알림)                                                                                                         |
| **Acceptance Criteria** | ✓ 알림 센터가 직관적<br>✓ 전화번호가 명확히 표시<br>✓ 전화 걸기 버튼 탭 시 전화 앱 실행                                                                     |

### 2.6 Reporting & Moderation

#### FR-026: 신고 기능

| Attribute               | Details                                                                                                                                                                                                                                 |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P1 (High)                                                                                                                                                                                                                               |
| **User Story**          | 사용자로서, 부적절한 작업이나 사용자를 신고하여 플랫폼을 안전하게 유지하고 싶다                                                                                                                                                         |
| **Input**               | 신고 대상 선택 (작업/사용자/연락 요청), 신고 사유 선택, 상세 내용 입력(선택)                                                                                                                                                            |
| **Processing**          | Reports Collection에 새 문서 생성                                                                                                                                                                                                       |
| **Output**              | 신고 접수 완료 메시지                                                                                                                                                                                                                   |
| **Business Rules**      | - 신고 타입: job / user / contact_request<br>- 신고 사유: 허위 정보 / 스팸 / 부적절한 연락 / 기타<br>- 상세 내용: 500자 제한<br>- 동일 대상 중복 신고 가능 (악의적 반복 신고는 별도 처리)<br>- 신고 상태: pending / reviewed / resolved |
| **Error Handling**      | - 네트워크 오류 시 재시도 옵션<br>- 신고 남용 시 경고 (하루 10건 이상)                                                                                                                                                                  |
| **Dependencies**        | None                                                                                                                                                                                                                                    |
| **Acceptance Criteria** | ✓ 신고 버튼이 명확히 보임<br>✓ 신고 사유가 명확히 분류됨<br>✓ 신고 후 즉시 확인 메시지 표시                                                                                                                                             |

#### FR-027: 신고 자동 처리

| Attribute               | Details                                                                                                                                                                                           |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P1 (High)                                                                                                                                                                                         |
| **User Story**          | 시스템으로서, 일정 수 이상의 신고가 누적되면 자동으로 조치를 취하고 싶다                                                                                                                          |
| **Input**               | 신고 생성 시 트리거 (Cloud Function)                                                                                                                                                              |
| **Processing**          | 동일 대상의 신고 수 확인, 3건 이상 시 자동 조치                                                                                                                                                   |
| **Output**              | 조치 결과 (사용자 정지 / 작업 숨김) 및 로깅                                                                                                                                                       |
| **Business Rules**      | - 신고 3건 누적 시 자동 조치<br>- 사용자 신고 → isActive=false 설정<br>- 작업 신고 → status='deleted' 설정<br>- 연락 요청 신고 → status='rejected' 설정<br>- 조치 사항은 이메일로 관리자에게 통보 |
| **Error Handling**      | - 처리 실패 시 로그 기록 및 관리자 알림<br>- 오탐지 시 수동 복구 가능                                                                                                                             |
| **Dependencies**        | FR-026 (신고 기능), Cloud Functions                                                                                                                                                               |
| **Acceptance Criteria** | ✓ 정확히 3건 시 자동 조치<br>✓ 조치된 대상은 즉시 서비스에서 제외<br>✓ 관리자에게 조치 내역 이메일 발송                                                                                           |

### 2.7 Analytics & Logging

#### FR-028: 이벤트 로깅

| Attribute               | Details                                                                                                                                                                                                                                                                                                       |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**            | P2 (Medium)                                                                                                                                                                                                                                                                                                   |
| **User Story**          | 시스템으로서, 사용자 행동을 추적하여 서비스 개선에 활용하고 싶다                                                                                                                                                                                                                                              |
| **Input**               | 주요 사용자 액션 발생 시 트리거                                                                                                                                                                                                                                                                               |
| **Processing**          | Events Collection에 이벤트 문서 생성                                                                                                                                                                                                                                                                          |
| **Output**              | 이벤트 로그 저장                                                                                                                                                                                                                                                                                              |
| **Business Rules**      | - 로깅 대상 이벤트:<br> • job_created: 작업 등록<br> • job_view: 작업 상세 보기<br> • contact_request_sent: 연락 요청 전송<br> • contact_accepted: 연락 요청 수락<br> • contact_rejected: 연락 요청 거절<br>- 각 이벤트에 userId, jobId, requestId, timestamp, metadata 포함<br>- 개인정보 제외 (전화번호 등) |
| **Error Handling**      | - 로깅 실패 시 무시 (사용자 경험에 영향 없음)<br>- 비동기 처리                                                                                                                                                                                                                                                |
| **Dependencies**        | 모든 주요 기능                                                                                                                                                                                                                                                                                                |
| **Acceptance Criteria** | ✓ 모든 주요 액션이 누락 없이 로깅<br>✓ 로깅이 앱 성능에 영향 없음<br>✓ 개인정보가 로그에 포함되지 않음                                                                                                                                                                                                        |

---
